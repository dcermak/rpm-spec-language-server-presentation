<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Creating a Language Server for RPM Spec Files</title>
<meta name="author" content="Dan 캛erm치k"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./node_modules/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./node_modules/reveal.js/dist/theme/simple.css" id="theme"/>

<link rel="stylesheet" href="./node_modules/@fortawesome/fontawesome-free/css/all.min.css"/>

<link rel="stylesheet" href="./custom-style.css"/>
<link rel="stylesheet" href="./node_modules/reveal.js/plugin/highlight/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './node_modules/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h2 class="title">Creating a Language Server for RPM Spec Files</h2>
<p class="subtitle" style="color: Gray;"></p>
<p class="author">Dan 캛erm치k</p>
<div style="float:left"><a href="https://www.linuxdays.cz/2024/" target="_blank"><img src="./media/linuxdays.cz-logo.svg" height="50px" style="margin-bottom:-12px"/>&nbsp; LinuxDays.cz 2024</a></div>
<div style="float:right;font-size:35px;"><p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by/4.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0 <i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i></a></p></div>
</section>

<section>
<section id="slide-org9615a3d">
<h2 id="org9615a3d">who -u</h2>
<p>
Dan 캛erm치k
</p>

<p>
 <div style="float:center">
 <table class="who-table">
 <tr><td><i class="fab fa-suse"></i></td><td> Software Developer @SUSE, SLE BCI releng</td></tr>
 <tr><td><i class="fab fa-fedora"></i></td><td> i3 SIG, Package maintainer</td></tr>
 <tr><td><i class="far fa-heart"></i></td><td> Developer Tools, Testing and Documentation, Home Automation</td></tr>
 <tr></tr>
 <tr></tr>
 <tr><td><i class="fa-solid fa-globe"></i></td><td> <a href="https://dancermak.name/">https://dancermak.name</a></td></tr>
 <tr><td><i class="fab fa-github"></i></td><td> <a href="https://github.com/dcermak/">dcermak</a></td></tr>
 <tr><td><i class="fab fa-mastodon"></i></td><td> <a href="https://mastodon.social/@Defolos">@Defolos@mastodon.social</a></td></tr>
 </table>
 </div>
</p>


</section>
</section>
<section>
<section id="slide-org390f948">
<h2 id="org390f948">What is a Language Server?</h2>
<aside class="notes">
<ul>
<li>old state: every language has a plugin for every editor</li>

<li>LSP: central server for code smarts</li>
<li>JSON RPC based protocol</li>
<li>support for syntax highlighting, code completion, jump to definition &amp; references, code folding, documentation</li>
<li>introduced by VSCode, originally invented by Microsoft, now open standard on github</li>

</ul>

</aside>

<p data-fragment-index="1" class="fragment appear">
<img src="./media/no-lsp.svg" height="500px"/>
</p>

</section>
<section id="slide-org390f948-split">
<p>
with a Language Server:
</p>

<p data-fragment-index="2" class="fragment appear">
<img src="./media/with-lsp.svg" height="500px"/>
</p>


</section>
</section>
<section>
<section id="slide-org2cb25b0">
<h2 id="org2cb25b0">RPM Spec Files</h2>
<p data-fragment-index="1" class="fragment appear">
<img src="./media/rpm-spec-file-example.png" height="400px"/>
</p>

<ul>
<li data-fragment-index="2" class="fragment appear">m4 inspired macro language</li>
<li data-fragment-index="3" class="fragment appear">no AST, processed &amp; executed during build</li>

</ul>

</section>
</section>
<section>
<section id="slide-org1ed6177">
<h2 id="org1ed6177">Why?</h2>
<ul>
<li class="fragment appear">Editor plugins simplistic &amp; inconsistent</li>
<li class="fragment appear">I want a real IDE for spec files</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgf11f49f">
<h2 id="orgf11f49f">Building the LSP</h2>
<ul>
<li class="fragment appear">Build as part of <a href="https://hackweek.opensuse.org/23/projects/lsp-server-for-spec-files">Hackweek 23</a> by <a href="https://floss.social/@mcepl">Mat캩j Cepl</a>, <a href="https://dancermak.name">Dan 캛erm치k</a> &amp; Jehan Singh</li>
<li class="fragment appear">Python</li>
<li class="fragment appear">LSP: <i class="fa-brands fa-github"></i> <a href="https://github.com/openlawlibrary/pygls/">openlawlibrary/pygls</a></li>
<li class="fragment appear">RPM parsing: <i class="fa-brands fa-github"></i> <a href="https://github.com/packit/specfile">packit/specfile</a></li>

</ul>

</section>
<section id="slide-orge8ff516">
<h3 id="orge8ff516">Features</h3>
<ul>
<li class="fragment appear">autocompletion using your system macros + spec sections</li>
<li class="fragment appear">expand macros on hover</li>
<li class="fragment appear">jump to definition for macros</li>
<li class="fragment appear">breadcrumbs</li>
<li class="fragment appear">experimental container mode</li>

</ul>

</section>
<section id="slide-orgc485c55">
<h3 id="orgc485c55">autocompletion &amp; macro expansion</h3>
<ul>
<li class="fragment appear"><code>specfile</code> wraps <code>rpm -E %_dump</code> and <code>rpm -E $macro</code></li>
<li class="fragment appear">spec sections obtained from upstream's documentation</li>
<li class="fragment appear">and additional keywords</li>

</ul>

</section>
<section id="slide-org797f268">
<h3 id="org797f268">jump to definition</h3>
<aside class="notes">
<ul>
<li>macros can have origins, in practice you see: <code>GLOBAL</code>, <code>SPEC</code>, <code>MACROFILES</code></li>

</ul>

</aside>

<ul>
<li class="fragment appear"><code>specfile</code> gives you origin of a macro</li>
<li class="fragment appear">use regex searches in spec</li>
<li class="fragment appear">or in <code>%_rpmmacrosdir</code></li>
<li class="fragment appear">use autogenerated <code>Provides: rpm_macro($name)</code></li>

</ul>

</section>
<section id="slide-org1f4bcf8">
<h3 id="org1f4bcf8">Container Mode</h3>
<aside class="notes">
<ul>
<li>rpm is using installed macros</li>

</ul>

</aside>
<ul>
<li class="fragment appear">ship server in container images</li>

</ul>

<p class="fragment (appear)">
<img src="./media/container-mode.svg" height="500px"/>
</p>

</section>
</section>
<section>
<section id="slide-org6603800">
<h2 id="org6603800">Demo!</h2>
<div class="outline-text-2" id="text-org6603800">
</div>
</section>
<section id="slide-orgd0ff840">
<h3 id="orgd0ff840">Challenges</h3>
<ul>
<li class="fragment appear">hidden global state</li>
<li class="fragment appear">in memory storage required</li>

</ul>

<ul>
<li>parsing errors are un-recoverable</li>
<li>editors are weird</li>
<li>macros are OS dependent</li>

</ul>

</section>
</section>
<section>
<section id="slide-org91232ca">
<h2 id="org91232ca">Roadmap</h2>
<ul>
<li class="fragment appear">improve container mode</li>
<li class="fragment appear">investigate <a href="https://gitlab.com/cryptomilk/tree-sitter-rpmspec">tree-sitter</a> integration</li>
<li class="fragment appear">better parser</li>
<li class="fragment appear">integration with bash-lsp</li>
<li class="fragment appear">commands to build RPMs</li>
<li class="fragment appear">syntax highlighting</li>
<li class="fragment appear">better testing</li>
<li class="fragment appear">publish the VSCode extension</li>
<li class="fragment appear">your idea here!</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgfb1608a">
<h2 id="orgfb1608a">游눛 Thank you 游눜</h2>
<ul>
<li>Mat캩j Cepl</li>
<li>Maxwell G</li>
<li>Jakub Kadl캜ik</li>
<li>Dmitri Popov</li>
<li>Jehan Singh</li>
<li>Danilo Spinella</li>
<li>and all the testers</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgf961874">
<h2 id="orgf961874">Links</h2>
<p>
<img src="media/presentation-qr.svg" height="300px"/>
</p>

<p>
<i class="fa-brands fa-github"></i> <a href="https://github.com/dcermak/rpm-spec-language-server"><code>github.com/dcermak/rpm-spec-language-server</code></a>
</p>

<p>
<i class="fa-solid fa-person-chalkboard"></i> <a href="https://dcermak.github.io/rpm-spec-language-server-presentation/rpm-spec-language-server-presentation.html">dcermak.github.io/rpm-spec-language-server-presentation</a>
</p>


</section>
</section>
<section>
<section id="slide-org8254b0a">
<h2 id="org8254b0a">Questions?</h2>
<p class="fragment (appear)">
Answers!
</p>
</section>
</section>
</div>
</div>
<script src="./node_modules/reveal.js/dist/reveal.js"></script>
<script src="./node_modules/reveal.js/plugin/highlight/highlight.js"></script>
<script src="./node_modules/reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealHighlight, RevealNotes, history],
transition: 'none', hash: true
});

</script>
</body>
</html>
